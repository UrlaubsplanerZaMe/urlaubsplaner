<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Urlaubsplaner</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{margin:0;}
#map{height:100vh;}
.card{
position:absolute;top:14px;left:14px;z-index:1000;
width:320px;background:#fff;border-radius:18px;
padding:14px;box-shadow:0 16px 40px rgba(0,0,0,0.2);
font-family:-apple-system;
}
.btn{padding:10px;border-radius:12px;border:0;background:#eee;width:100%;margin-top:6px;font-weight:700;}
.row{display:flex;gap:6px;margin-bottom:8px;}
.meta{font-size:13px;margin-top:8px;}
</style>
</head>
<body>

<div class="card">

<div class="row">
<button class="btn" onclick="mode='start'">Start</button>
<button class="btn" onclick="mode='stop'">Stopp</button>
<button class="btn" onclick="mode='ziel'">Ziel</button>
</div>

<button class="btn" onclick="saveRoute()">Route speichern</button>
<button class="btn" onclick="loadRoute()">Gespeicherte Route laden</button>
<button class="btn" onclick="clearRoute()">Route lÃ¶schen</button>

<div class="meta" id="meta"></div>

</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

const map=L.map('map').setView([51.1657,10.4515],6);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

let mode=null;
let startMarker,endMarker;
let stopMarkers=[];

function createMarker(latlng,label){
const m=L.marker(latlng,{draggable:true}).addTo(map).bindPopup(label);

m.on("dragend",()=>{
buildRoute();
saveRoute();
});

return m;
}

map.on("click",e=>{

if(!mode)return;

if(mode==="start"){
if(startMarker)map.removeLayer(startMarker);
startMarker=createMarker(e.latlng,"Start");
}

if(mode==="ziel"){
if(endMarker)map.removeLayer(endMarker);
endMarker=createMarker(e.latlng,"Ziel");
}

if(mode==="stop"){
const m=createMarker(e.latlng,"Stopp");
stopMarkers.push(m);
}

buildRoute();
saveRoute();
mode=null;

});

async function route(coords){

const c=coords.map(c=>`${c.lng},${c.lat}`).join(";");

const res=await fetch(`https://router.project-osrm.org/route/v1/driving/${c}?overview=full&geometries=geojson`);
const data=await res.json();

return data.routes[0];
}

async function buildRoute(){

if(!startMarker || !endMarker) return;

let coords=[startMarker.getLatLng()];
stopMarkers.forEach(m=>coords.push(m.getLatLng()));
coords.push(endMarker.getLatLng());

const r=await route(coords);

if(window.routeLine)map.removeLayer(window.routeLine);

window.routeLine=L.geoJSON(r.geometry,{style:{weight:6}}).addTo(map);
map.fitBounds(window.routeLine.getBounds());

meta.innerHTML=`Distanz ${(r.distance/1000).toFixed(1)} km<br>Zeit ${Math.round(r.duration/60)} min`;

}

// ðŸ’¾ ROUTE SPEICHERN
function saveRoute(){

const data={
start:startMarker?startMarker.getLatLng():null,
end:endMarker?endMarker.getLatLng():null,
stops:stopMarkers.map(m=>m.getLatLng())
};

localStorage.setItem("route",JSON.stringify(data));

}

// ðŸ“¥ ROUTE LADEN
function loadRoute(){

const data=JSON.parse(localStorage.getItem("route"));
if(!data)return;

clearMap();

if(data.start) startMarker=createMarker(data.start,"Start");
if(data.end) endMarker=createMarker(data.end,"Ziel");

data.stops.forEach(s=>{
const m=createMarker(s,"Stopp");
stopMarkers.push(m);
});

buildRoute();
}

// âŒ ROUTE LÃ–SCHEN
function clearRoute(){
localStorage.removeItem("route");
clearMap();
}

// ðŸ§¹ KARTE LEEREN
function clearMap(){

if(startMarker)map.removeLayer(startMarker);
if(endMarker)map.removeLayer(endMarker);
stopMarkers.forEach(m=>map.removeLayer(m));

startMarker=null;
endMarker=null;
stopMarkers=[];

if(window.routeLine)map.removeLayer(window.routeLine);

}

// ðŸš€ BEIM START AUTOMATISCH LADEN
loadRoute();

</script>

</body>
</html>
